classes:
  - role_base::server-mysql

# Install MySQL server using mysql::server: root_password
role_mysql::mysql_root_password: 'mypass'

# Install MySQL server using mysql::server: override_options
role_mysql::override_options:
  mysqld:
    bind-address: '0.0.0.0'
    max_allowed_packet: '512M'

# Install MySQL server using mysql::server: users
role_mysql::users:
  'application-user@localhost':
    ensure: 'present'
    password: 'mypass'
  'application-user@%':
    ensure: 'present'
    password: 'mypass'

# Install MySQL server using mysql::server: grants
role_mysql::grants:
  'application-user@localhost/mydb.*':
    privileges:
      - ALL
    table: 'mydb.*'
    user: 'application-user@localhost'
  'application-user@%/mydb.*':
    privileges:
      - ALL
    table: 'mydb.*'
    user: 'application-user@%'

# Create databases using mysql::db with initial user
role_mysql::db_hash:
  mydb:
    user: 'manager'
    password: 'mypass'
    host: 'localhost'
    grant:
      - SELECT
